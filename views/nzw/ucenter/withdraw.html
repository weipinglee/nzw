
<header class="uc_head_tab">
	<span class="money">账户余额：<em>￥{$this->memberRow['balance']}</em></span>
	<a href='{url:/ucenter/account_log}'>交易记录</a>
	<h3>提现记录</h3>
</header>

<section class="uc_table">
	<table>
		<col />
		<col />
		<col width="100px" />
		<col width="140px" />
		<col width="80px" />
		<col width="80px" />
		<thead>
			<tr>
				<th>会员备注</th><th>管理员备注</th><th>金额</th><th>申请时间</th><th>状态</th><th>操作</th>
			</tr>
		</thead>
		<tbody>
			{set:$page=(isset($_GET['page'])&&(intval($_GET['page'])>0))?intval($_GET['page']):1;}
			{set:$user_id = $this->user['user_id']}
			{set:$queryWithdrawList = Api::run('getWithdrawList',$user_id)}
			{foreach:items = $queryWithdrawList->find()}
			<tr>
				<td>{$item['note']}</td>
				<td>{$item['re_note']}</td>
				<td>{$item['amount']} 元</td>
				<td>{$item['time']}</td>
				<td>{echo:AccountLog::getWithdrawStatus($item['status'])}</td>
				<td>
					{if:$item['status']==0}
					<a href="javascript:delModel({link:'{url:/ucenter/withdraw_del/id/$item[id]}','msg':'确定要取消吗？'});">取消</a>
					{else:}
					<a href="javascript:;">删除</a>
					{/if}
				</td>
			</tr>
			{/query}
		</tbody>
	</table>
</section>

{$queryWithdrawList->getPageBar()}

<header class="uc_head">
	<h3>申请提现</h3>
</header>
<section class="user_form">
	<form action='{url:/ucenter/withdraw_act}' method='post' name='withdraw'>
		<dl>
			<dt>持卡人姓名：</dt>
			<dd>
				<input type="text" class="input_text" name='name' pattern='required' alt='请填写真实的持卡人姓名' />
				<span><i class='red'>*</i> 填写持卡人真实的姓名</span>
			</dd>
		</dl>
		<dl>
			<dt>提现金额：</dt>
			<dd>
				<input type="text" class="input_text" name='amount' pattern='float' max-value="{$this->memberRow['balance']}" alt='填写体现金额' />
				<span><i class='red'>*</i> 要提现的金额，此数值不得大于当前的账户余额</span>
			</dd>
		</dl>
		<dl>
			<dt>开户银行：</dt>
			<dd>
				<input type="text" class="input_text" name='bank' pattern='required' alt='填写开户银行' />
				<span><i class='red'>*</i> 填写开户银行</span>
			</dd>
		</dl>
		<dl>
			<dt>账号：</dt>
			<dd>
				<input type="text" class="input_text" name='account' pattern='required' alt='填写银行账号' />
				<span><i class='red'>*</i> 填写银行账号</span>
			</dd>
		</dl>
		<dl>
			<dt>备注：</dt>
			<dd>
				<textarea name='note' class="input_textarea" alt='填写一些必要的提现信息'></textarea><br />
				<span class="filinfo"><!-- <i class='red'>*</i> 填写必要的提现信息，如开户银行，帐号等 -->请填写备注信息</span>
			</dd>
		</dl>
		<dl>
			<dt></dt>
			<dd><input class="input_submit" type="submit" value="确定提交" onclick='return checkForm()'/></dd>
		</dl>
	</form>
</section>


<script type='text/javascript'>
	var formObj = new Form('withdraw');
	formObj.init({
		'name':'{$this->withdrawRow['name']}',
		'note':'{$this->withdrawRow['note']}',
        'amount':'{$this->withdrawRow['amount']}',
        'bank':'{$this->withdrawRow['bank']}',
        'account':'{$this->withdrawRow['account']}'
	});
    function checkForm(){
        var amount = $('input[name=amount]').val();
        var max = parseFloat($('input[name=amount]').attr('max-value'));
        if(amount>max){
            alert('要提现的金额不能大于当前的账户余额');
            return false;
        }
        else if(amount < 0)
        {
            alert('要提现的金额必须大于零');
            return false;
        }
        else return true;
    }
</script>
